# Nginx
![Nginx text](image.png)

> [!NOTE]
> _В данном репозитории находится дефолтный конфигурационный файл nginx.conf_

**Nginx** ***( **engine x** — по-русски произносится как **энджи́нкс** или **э́нжин-и́кс** )*** — веб-сервер и почтовый прокси-сервер, работающий на Unix-подобных операционных системах (тестировалась сборка и работа на FreeBSD, OpenBSD, Linux, Solaris, macOS, AIX и HP-UX). Начиная с версии 0.7.52 появилась экспериментальная бинарная сборка под ~~Microsoft~~  Windows.

_[Игорь Сысоев](https://ru.wikipedia.org/wiki/%D0%A1%D1%8B%D1%81%D0%BE%D0%B5%D0%B2,_%D0%98%D0%B3%D0%BE%D1%80%D1%8C_%D0%92%D0%BB%D0%B0%D0%B4%D0%B8%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B8%D1%87_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%81%D1%82)) начал разработку в 2002 году. Осенью 2004 года вышел первый публично доступный релиз. С июля 2011 работа над nginx продолжается в рамках компании Nginx.Перейти к разделу «#Компания Nginx»_

## Основные функции

**Nginx** __позиционируется производителем как простой, быстрый и надёжный сервер, не перегруженный функциями.__

> [!IMPORTANT]
> Применение nginx целесообразно прежде всего для статических веб-сайтов и как обратного прокси-сервера перед динамическими сайтами.

## Основные контексты 

| **Контекст** 	|                                                                                                                    **Описание**                                                                                                                   	|                                                                                    **Описание Формата**                                                                                    	|                                                           **Формат**                                                          	|
|:------------:	|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:	|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:	|:-----------------------------------------------------------------------------------------------------------------------------:	|
|   **main**   	| Основным контекстом является main.  Этот глобальный контекст является единственным,  который не содержится в типичных блоках контекста,  которые выглядят следующим образом:                                                                      	| _контекст main находится здесь,  вне любых других контекстов_                                                                                                                              	| ```  . . .  context {  . . .  } ```                                                                                           	|
|  **events**  	| Контекст events находится внутри контекста main.  Он определяет глобальные параметры, влияющие на то, как Nginx обрабатывает соединения.  В конфигурации Nginx может быть только один контекст events.                                            	| _Этот контекст будет выглядеть так:_                                                                                                                                                       	| ```  # main context  events {  # events context  . . .  } ```                                                                 	|
|   **http**   	| При настройке Nginx как веб-сервера или обратного прокси-сервера большую часть конфигурации будет содержать контекст http.  Этот контекст хранит все директивы и другие контексты, необходимые для настройки обработки соединений HTTP или HTTPS. 	| _Контексты http и events принадлежат одному уровню,  потому они не вкладываются друг в друга, а определяются как одноранговые.  Оба они являются дочерними по отношению к контексту main._ 	| ```  # main context  events {  # events context  . . .  }  http {  # main context  . . .  } ```                               	|
|  **server**  	| Контекст server обычно объявляется в контексте http.  Это первый пример вложенного контекста в этом мануале.  Это также первый контекст, который можно объявить несколько раз.                                                                    	| _Общий формат контекста server может выглядеть примерно так (помните, что он находится в контексте http):_                                                                                 	| ```  # main context  http {  # http context  server {  # first server context  }  server {  # second server context  }  } ``` 	|


### HTTP-сервер

* обслуживание неизменяемых запросов, индексных файлов, автоматическое создание списка файлов, кэш дескрипторов открытых файлов
* акселерированное проксирование без кэширования, простое распределение нагрузки и отказоустойчивость
* поддержка кеширования при акселерированном проксировании и FastCGI
* акселерированная поддержка FastCGI и memcached-серверов, простое распределение нагрузки и отказоустойчивость
* модульность, фильтры, в том числе сжатие (gzip), byte-ranges (докачка), chunked-ответы, HTTP-аутентификация, SSI-фильтр
* несколько подзапросов на одной странице, обрабатываемых в SSI-фильтре через прокси или FastCGI, выполняются параллельно
* поддержка SSL
* поддержка PSGI, WSGI
* экспериментальная поддержка встроенного Perl
### SMTP/IMAP/POP3-прокси сервер

1. перенаправление пользователя на SMTP/IMAP/POP3-бэкенд с использованием внешнего HTTP-сервера аутентификации
1. простая аутентификация (LOGIN, USER/PASS)
1. поддержка SSL и STARTTLS

## Архитектура
В nginx рабочие процессы обслуживают одновременно множество соединений, мультиплексируя их вызовами операционной системы select, epoll (**Linux**) и kqueue (**FreeBSD**). Рабочие процессы выполняют цикл обработки событий от дескрипторов (см. Событийно-ориентированное программирование). Полученные от клиента данные разбираются с помощью конечного автомата. Разобранный запрос последовательно обрабатывается цепочкой модулей, задаваемой конфигурацией. Ответ клиенту формируется в буферах, которые хранят данные либо в памяти, либо указывают на отрезок файла. Буфера объединяются в цепочки, определяющие последовательность, в которой данные будут переданы клиенту. Если операционная система поддерживает эффективные операции ввода-вывода, такие, как writev и sendfile, то **nginx** применяет их по возможности.

Алгоритм работы HTTP-сервера выглядит следующим образом:

1. Получить очередной дескриптор из kevent(2);
1. Прочитать данные из файла и записать в socket, используя либо write(2)/read(2), например, так:

```
while
(
   (
      cnt = read
      (
         read_file_descriptor,
         buffer,
         block_size
      ),
      write
      (
         socket_file_descriptor,
         buffer,
         count
      ) == cnt
   )
)
   byte_count += count;
```
либо используя системный вызов sendfile(2), выполняющий те же действия, что приведённый выше код, но в пространстве ядра;
3.перейти к шагу 1.

Конфигурация **[HTTP-сервера](https://ru.wikipedia.org/wiki/%D0%92%D0%B5%D0%B1-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80)** nginx разделяется на виртуальные серверы (директива «server»). Виртуальные серверы разделяются на **location’ы** (**«location»**). Для виртуального сервера возможно задать адреса и порты, на которых будут приниматься соединения, а также имена, которые могут включать «*» для обозначения произвольной последовательности в первой и последней части либо задаваться регулярным выражением.

**location’ы** могут задаваться точным **[URI](https://ru.wikipedia.org/wiki/URI)**, частью **URI** либо [регулярным выражением](https://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%B3%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B5_%D0%B2%D1%8B%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F). **Location’ы** могут быть сконфигурированы для обслуживания запросов из статического файла, проксирования на **fastcgi/memcached** сервер.

Для эффективного управления памятью **nginx** использует пулы. **Пул** — это последовательность предварительно выделенных блоков динамической памяти. 
Длина блока варьируется от 1 до 16 килобайт. Изначально под пул выделяется только один блок. 
Блок разделяется на занятую область и незанятую. 
Выделение мелких объектов выполняется путём продвижения указателя на незанятую область с учётом выравнивания. 
Если незанятой области во всех блоках не хватает для выделения нового объекта, то выделяется новый блок. 
Если размер выделяемого объекта превышает значение константы ***NGX_MAX_ALLOC_FROM_POOL*** либо длину блока, то он полностью выделяется из кучи.

Таким образом, мелкие объекты выделяются очень быстро и имеют накладные расходы только на выравнивание.

**nginx** содержит модуль географической классификации клиентов по IP-адресу. В его основу входит база данных соответствия [IP-адресов](https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81) географическому региону, представленная в виде radix tree (сжатое префиксное дерево или сжатый лес) в оперативной памяти. nginx предварительно распределяет первые несколько уровней дерева таким образом, чтобы они занимали ровно 1 страницу памяти. Это гарантирует, что при поиске IP-адреса для первых нескольких узлов при трансляции адреса всегда найдётся запись в TLB.

### :+1: Популярность :shipit:
- По данным Netcraft на август 2020 года, число сайтов, обслуживаемых nginx, превышает 448 миллионов, что делает его первым по популярности веб-сервером в мире. Доля среди активных сайтов — 19,74 %, что ставит nginx на второе место после веб-сервера Apache.

  - По данным W3Techs, nginx наиболее часто используется на высоконагруженных сайтах, занимая первое место по частоте использования среди 100 000 самых посещаемых сайтов в мире — больше трети из них работает на nginx.

    - По данным российского регистратора REG.RU, nginx является самым популярным веб-сервером доменных зон .ru[^1], .рф[^2] и .su, обслуживая более половины каждого сегмента. nginx — самый популярный веб-сервер в России с долей рынка 65,90 %.



     [^1]: Веб-серверы зоны .RU. Дата обращения: 6 февраля 2014. Архивировано 9 февраля 2014 года.

     [^2]: Веб-серверы зоны .РФ. Дата обращения: 6 марта 2014. Архивировано 2 марта 2014 года.